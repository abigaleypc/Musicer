<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>登录</title>
</head>

<body>
  <input id="username" name="username" type="text" placeholder="用户名" />
  <input id="password" name="password" type="password" placeholder="密码" />
  <button id="login">login</button>
  <script>
    const { ipcRenderer } = window.require('electron');
    const request = require('request')


    document.querySelector('#login').addEventListener('click', () => {

      let username = document.getElementById('username').value;
      let password = document.getElementById('password').value;
      verifyNotNull(username, password).then(res => {
        // if (res.code === 1) {
        //   ipcRenderer.send('is-login-window', false)
        // }
      }).catch(err => {
      })



    })

    function verifyUser(username, password) {
      var url = 'http://localhost:8082/login';
      request.post(url, {
        json: true,
        qs: {
          username,
          password
        }
      }).on('error', err => {
        res.status(500).end(err);
      }).on('data', res => {
        let result = JSON.parse(res.toString());
        if (result.code == 1) {
          ipcRenderer.send('login-event', { isLogin: true });
        } else {
          //提示密码错误
          ipcRenderer.send('login-event', { isLogin: false })
        }
      })
    }


    function verifyNotNull(username, password) {
      let u = username, p = password;

      return new Promise(function (resolve, reject) {
        if (u && p) {
          let res = verifyUser(u, p)
          resolve(res)
        } else if (!u && p) {
          resolve('账号不为空');
        } else if (u && !p) {
          resolve('密码不为空');
        } else {
          resolve('账号，密码不为空');
        }
      })
    }


  </script>
</body>

</html>
